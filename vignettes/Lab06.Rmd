---
title: "Lab06"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Lab06}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Lab06)
library(parallel)
```
Generate knapsack with 2000 items
```{r}
RNGversion(min(as.character(getRversion()),"3.5.3"))

set.seed(42, kind = "Mersenne-Twister", normal.kind = "Inversion")

n <- 2000
knapsack_objects <-
  data.frame(
    w=sample(1:4000, size = n, replace = TRUE),
    v=runif(n = n, 0, 10000)
  )

n <- 100000
knapsack_objects_greedy <-
  data.frame(
    w=sample(1:4000, size = n, replace = TRUE),
    v=runif(n = n, 0, 10000)
  )

```
We run the system.time() function 10 times with a for loop to obtain the average
time of the function to reduce the time error. And have a more precise comparison.
1.1.2 Brute force search

Time for n=16 objects:

```{r}
n_select <- 16
system.time({brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500)})

```

1.1.3 Dynamic programming

Time for n=500 objects:

```{r}
#Add dynamic programming
```

1.1.4 Greedy heuristic


```{r}
n<-10
system.time(for (i in 1:n) greedy_knapsack(knapsack_objects[1:1200,],W=3500)) / n
#100000 Objects
system.time(for (i in 1:n)greedy_knapsack(knapsack_objects_greedy[1:100000,],W=3500))/n
```
How much time does it takes to run the algorithm for n = 1000000 objects?
It takes 36.018 seconds.
Approximately 35 seconds more than with 1200 objects.

1.1.5 Improvement of greedy heuristic

```{r}
n<-10
system.time(for (i in 1:n) greedy_knapsack(knapsack_objects[1:1200,],W=3500)) / n
greedy_knapsack(knapsack_objects[1:1200,],W=3500)
system.time(for (i in 1:n) greedy_knapsack(knapsack_objects[1:1200,],W=3500,"plus")) / n
greedy_knapsack(knapsack_objects[1:1200,],W=3500,"plus")
```
"Plus" optimization, finds the next item which Weight value fits the  Weight 
limit of the knapsack. In this particular case is the item 764, as we can see 
above.

1.1.6 Profile your code and optimize your code

... Below examples... develop text
```{r}

n_select <- 16
#- For loop
brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="forloop")
system.time({
brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="forloop")
})

#- Matrix --------------------#
#filter items = false
brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="matrix")
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="matrix")
})

#- Apply --------------------#
brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="apply1a")
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="apply1a")
})

brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="apply1b")
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="apply1b")
})

brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="apply2")
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="apply2")
})

```

1.1.8 Parallelize brute force search

... add more text ....

comment re. ncores 
```{r}
#- Set number of knapsack items
n_select <- 16

#- Set number of cores
ncores <- 2

#- Note. number of available cores can be checked with:
ncores_available <- parallel::detectCores()

#- Parallel --------------------#
brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1a", ncores=ncores)
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1a", ncores=ncores)
})

brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1b", ncores=ncores)
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1b", ncores=ncores)
})

brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel2", ncores=ncores)
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel2", ncores=ncores)
})


```

Try with only one (1) core:
```{r}
#- Set number of cores
ncores <- 1


#- Parallel --------------------#
brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1a", ncores=ncores)
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1a", ncores=ncores)
})

brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1b", ncores=ncores)
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel1b", ncores=ncores)
})

brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel2", ncores=ncores)
system.time({
  brute_force_knapsack(x = knapsack_objects[1:n_select,], W = 3500, type="parallel2", ncores=ncores)
})

```

